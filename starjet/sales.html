<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' https://*.supabase.co;">
    <title>Sales Entry - Star Jet</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .a5-sales-container {
            max-width: 900px;
            margin: 32px auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            padding: 32px 24px 24px 24px;
            border: 4px solid #b3006b;
        }

        .a5-sales-header {
            text-align: center;
            margin-bottom: 18px;
        }

        .a5-sales-header img {
            max-width: 220px;
        }

        .a5-sales-title {
            color: #b3006b;
            font-size: 2.2rem;
            font-weight: bold;
            margin: 8px 0 0 0;
        }

        .a5-customer-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .a5-customer-block {
            font-size: 1rem;
        }

        .a5-customer-label {
            background: #b3006b;
            color: #fff;
            font-weight: bold;
            padding: 2px 14px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 4px;
        }

        .a5-sales-table {
            width: 100%;
            border-collapse: collapse;
            margin: 18px 0 8px 0;
        }

        .a5-sales-table th,
        .a5-sales-table td {
            border: 1.5px solid #b3006b;
            padding: 6px;
            text-align: center;
        }

        .a5-sales-table th {
            background: #b3006b;
            color: #fff;
            font-weight: bold;
        }

        .a5-add-item-btn {
            background: #b3006b;
            color: #fff;
            border: none;
            padding: 8px 22px;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .a5-remove-item-btn {
            background: #fff;
            color: #b3006b;
            border: 1.5px solid #b3006b;
            border-radius: 4px;
            font-size: 1rem;
            padding: 2px 10px;
            cursor: pointer;
        }

        .a5-remove-item-btn:hover {
            background: #b3006b;
            color: #fff;
        }

        .a5-totals-row {
            display: flex;
            justify-content: flex-end;
            gap: 32px;
            margin-top: 18px;
            align-items: center;
        }

        .a5-totals-row label {
            font-weight: bold;
            color: #b3006b;
            margin-right: 6px;
        }

        .a5-totals-row input {
            width: 100px;
            padding: 4px 8px;
            border: 1.5px solid #b3006b;
            border-radius: 4px;
            font-size: 1rem;
            text-align: right;
        }

        .a5-submit-btn {
            background: #b3006b;
            color: #fff;
            border: none;
            padding: 12px 38px;
            border-radius: 6px;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 32px auto 0 auto;
            display: block;
            cursor: pointer;
        }

        @media (max-width: 700px) {
            .a5-sales-container {
                padding: 8px 2px;
            }

            .a5-totals-row {
                flex-direction: column;
                gap: 8px;
                align-items: flex-end;
            }
        }
    </style>
</head>

<body>
    <nav class="side-nav">
        <ul class="nav-menu">
            <!-- Navigation will be dynamically rendered based on user role -->
        </ul>
    </nav>
    <div class="container main-content">
        <h1 style="text-align:center; color:#b3006b;">Sales Entry</h1>
        <form id="salesForm">
            <div style="display: flex; gap: 24px; margin-bottom: 18px;">
                <div class="form-row">
                    <label for="customerName">Customer Name</label>
                    <input type="text" id="customerName" name="customerName" required>
                </div>
                <div class="form-row">
                    <label for="customerPhone">Customer Phone</label>
                    <input type="text" id="customerPhone" name="customerPhone" required>
                </div>
                <div class="form-row" style="margin-left:auto;">
                    <label for="salesDate">Date</label>
                    <input type="text" id="salesDate" name="salesDate" readonly style="width:120px; text-align:center;">
                </div>
            </div>
            <table class="a5-sales-table" id="itemsTable">
                <thead>
                    <tr>
                        <th>Item#</th>
                        <th>Width</th>
                        <th>Length</th>
                        <th>Space</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Total</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="itemsTbody">
                    <!-- One blank row by default -->
                    <tr>
                        <td><input type="text" name="item[]" style="width:90px;" placeholder="Item" required></td>
                        <td><input type="number" name="width[]" step="0.01" min="0" style="width:70px;"></td>
                        <td><input type="number" name="length[]" step="0.01" min="0" style="width:70px;"></td>
                        <td><input type="text" name="space[]" style="width:70px;"></td>
                        <td><input type="number" name="quantity[]" min="0" style="width:70px;" required></td>
                        <td><input type="number" name="unitPrice[]" step="0.01" min="0" style="width:90px;" required>
                        </td>
                        <td><input type="number" name="itemTotal[]" readonly style="width:90px;"></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="a5-add-item-btn" id="addItemBtn" style="margin: 12px 0 0 0;">+ Add
                Item</button>
            <div style="display:flex; justify-content:flex-end; margin-top:12px;">
                <table>
                    <tr>
                        <td><label for="supTotal">Sup Totel:</label></td>
                        <td><input type="number" id="supTotal" name="supTotal" readonly></td>
                    </tr>
                    <tr>
                        <td><label for="discount">Discount%:</label></td>
                        <td><input type="number" id="discount" name="discount" min="0" max="100" value="0"></td>
                    </tr>
                    <tr>
                        <td><label for="total">Totel:</label></td>
                        <td><input type="number" id="total" name="total" readonly></td>
                    </tr>
                </table>
            </div>
            <button type="submit" class="a5-submit-btn" style="margin-top:24px;">Make a Sale</button>
        </form>
    </div>
    <!-- API Client for server communication -->
    <script src="config.js"></script>
    <script src="api-client.js"></script>
    <script src="auth.js"></script>
    <script src="user-profile.js"></script>
    <script src="access-control.js"></script>
    <script src="toast-notifications.js"></script>
    <script src="sales.js"></script>
    <script>
        // Set today's date
        document.getElementById('salesDate').value = new Date().toISOString().slice(0, 10);
        // Add item row logic
        document.getElementById('addItemBtn').onclick = function () {
            const tr = document.createElement('tr');
            tr.innerHTML = `
            <td><input type="text" name="item[]" style="width:90px;" placeholder="Item" required></td>
            <td><input type="number" name="width[]" step="0.01" min="0" style="width:70px;"></td>
            <td><input type="number" name="length[]" step="0.01" min="0" style="width:70px;"></td>
            <td><input type="text" name="space[]" style="width:70px;"></td>
            <td><input type="number" name="quantity[]" min="0" style="width:70px;" required></td>
            <td><input type="number" name="unitPrice[]" step="0.01" min="0" style="width:90px;" required></td>
            <td><input type="number" name="itemTotal[]" readonly style="width:90px;"></td>
            <td><button type="button" class="a5-remove-item-btn">Remove</button></td>
        `;
            document.getElementById('itemsTbody').appendChild(tr);
            tr.querySelector('.a5-remove-item-btn').onclick = function () {
                tr.remove();
            };
        };
        // Remove button for future rows
        Array.from(document.getElementsByClassName('a5-remove-item-btn')).forEach(btn => {
            btn.onclick = function () {
                btn.closest('tr').remove();
            };
        });

        // Initialize dynamic navigation rendering
        document.addEventListener('DOMContentLoaded', function () {
            // Listen for access control ready event
            document.addEventListener('accessControlReady', function (event) {
                const navElement = document.querySelector('.side-nav');
                if (navElement && event.detail.accessControl) {
                    event.detail.accessControl.renderNavigation(navElement);
                }
            });

            // Fallback: if access control is already ready, render immediately
            if (window.accessControl && window.accessControl.getCurrentRole()) {
                const navElement = document.querySelector('.side-nav');
                if (navElement) {
                    window.accessControl.renderNavigation(navElement);
                }
            }
        });
    </script>
</body>

</html>